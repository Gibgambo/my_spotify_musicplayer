<!doctype html>
<html lang="de">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spotify MusicPlayer</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <!-- Spotify Web Playback SDK -->
  <script src="https://sdk.scdn.co/spotify-player.js"></script>

  <script src="js/app.js"></script>

</head>

<body class="min-h-screen bg-slate-900 text-slate-100">
  <div class="max-w-4xl mx-auto p-6" x-data="spotifyPlayer()" x-init="init()">

    <!-- Header mit Status rechts -->
    <header class="mb-8 flex justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold">üéµ Mein Spotify HandballPlayer</h1>
        <p class="text-slate-300">Mit Spotify verbinden und Songs abspielen.</p>
      </div>

      <!-- Login / Logout Status -->
      <div>
        <!-- Login-Button nur anzeigen, wenn kein Token -->
        <button x-show="!token" class="rounded-2xl px-4 py-2 bg-emerald-500 hover:bg-emerald-600 transition shadow"
          @click="login">
          Login
        </button>

        <!-- Logout-Button mit Status -->
        <div x-show="token" class="flex items-center space-x-3">
          <span class="text-slate-300">‚úÖ Eingeloggt</span>
          <button class="rounded-2xl px-4 py-2 bg-red-500 hover:bg-red-600 transition shadow" @click="logout">
            Logout
          </button>
        </div>
      </div>
    </header>

    <!-- Hauptbereich nur sichtbar wenn eingeloggt -->
    <main class="space-y-6" x-show="token">
      <!-- Aktueller Track Bereich -->
      <div class="rounded-2xl bg-slate-800/60 p-6 shadow" x-show="currentTrack.name != ''">
        <!-- Steuerbuttons oben -->
        <div class="flex justify-center items-center space-x-6 mb-4">
          <!-- Back -->
          <button class="rounded-full bg-slate-700 hover:bg-slate-600 p-3 shadow" @click="previousTrack">
            ‚èÆ
          </button>

          <!-- Play/Pause -->
          <button class="rounded-full bg-blue-500 hover:bg-blue-600 p-4 shadow" @click="togglePlay">
            <span x-text="isPlaying ? '‚è∏' : '‚ñ∂'"></span>
          </button>

          <!-- Next -->
          <button class="rounded-full bg-slate-700 hover:bg-slate-600 p-3 shadow" @click="nextTrack">
            ‚è≠
          </button>
        </div>

        <!-- Track Info + Album Cover -->
        <div class="flex items-center space-x-4">
          <img :src="currentTrack.albumImage" alt="Cover" class="w-16 h-16 rounded-xl">
          <div class="flex-1">
            <h2 class="text-xl font-bold" x-text="currentTrack.name"></h2>
            <p class="text-slate-300" x-text="currentTrack.artist"></p>
            <p class="text-sm text-slate-400">
              <span x-text="formatTime(progressMs)"></span> /
              <span x-text="formatTime(currentTrack.duration)"></span>
            </p>

            <!-- Fortschrittsbalken -->
            <input type="range" min="0" :max="currentTrack.duration" step="1000" :value="progressMs"
              @mousedown="isSeeking = true" @touchstart="isSeeking = true" @input="progressMs = $event.target.value"
              @mouseup="isSeeking = false; seek($event.target.value)"
              @touchend="isSeeking = false; seek($event.target.value)"
              class="w-full h-2 mt-2 rounded-lg accent-emerald-500">
          </div>

          <!-- Lautst√§rke -->
          <div class="flex flex-col items-center space-y-2 ml-4">
            <div class="flex items-center space-x-2">
              <!-- Lautst√§rke Icon -->
              <button @click="toggleMute" class="focus:outline-none">
                <template x-if="!isMuted">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-300" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5L6 9H2v6h4l5 4V5z" />
                  </svg>
                </template>
                <template x-if="isMuted">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-300" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M11 5L6 9H2v6h4l5 4V5zM19 5l-6 6m0-6l6 6" />
                  </svg>
                </template>
              </button>

              <input type="range" min="0" max="1" step="0.01" x-model="volume" @input="setVolume($event.target.value)"
                class="w-24 h-1 rounded-lg accent-emerald-500">
            </div>
          </div>
        </div>
      </div>


        <div class="rounded-2xl bg-slate-800/60 p-6 shadow space-x-4">
          <button class="rounded-2xl px-5 py-3 bg-purple-500 hover:bg-purple-600 transition shadow"
            @click="playPlaylist(playlists.torparade)">
            ‚ñ∂ Torparade
          </button>

          <button class="rounded-2xl px-5 py-3 bg-pink-500 hover:bg-pink-600 transition shadow"
            @click="playPlaylist(playlists.zweiMinGegner)">
            ‚ñ∂ 2 Minuten Gegner
          </button>
          
          <button class="rounded-2xl px-5 py-3 bg-amber-500 hover:bg-amber-600 transition shadow"
            @click="playPlaylist(playlists.einlaufmusik)">
            ‚ñ∂ Einlaufmusik
          </button>
        </div>
    </main>
  </div>
</body>
</html>